---
title: Specification by Example
order: 70
---

<div class="chapter_quote"><p>
Есть две бесконечные вещи: Вселенная и человеческая глупость. Впрочем, насчёт первой я не уверен.
<br/>
--Альберт Эйнштейн
</p></div>

Требования на Примерах (Specification by Example) или разработка через приёмочное тестирование (A-TDD) - это подход совместного выявления требований, в котором примеры и автотесты используются для определения требований, тем самым создавая исполняемые спецификации. Такие спецификации создаются командами вместе с Владельцем Продукта и другими заинтересованными лицами на совместных сессиях по  сбору требований.

Заметка по терминологии: Мы будем использовать как и A-TDD, так и Specification by Example.

A-TDD объединяет следующие основные идеи:

* тесты как требования, требования как тесты
* совместные сессии по прояснению требований
* параллельная разработка
* предотвращение вместо обнаружения

**Тесты как требования, требования как тесты** — В книге [Exploring Requirements: Quality before Design](http://www.amazon.com/Exploring-Requirements-Quality-Before-Design/dp/0932633137) её авторы Дональд Гаус и Джеральд Вайнберг исследуют связь между требованиями и тестами: “Одним из самых эффективных способов тестирования требований являются тест-кейсы, очень похожие на те, что используются для тестирования готовой системы". [Григорий Мельник и Боб Мартин](http://gmelnik.com/papers/Melnik-Martin-Tests-and-Requirements-The-Moebius-Strip-IEEE-Software-2008.pdf) далее расширяют это и утверждают: “Если формализовать данное утверждение, тесты и требования становятся неразличимыми. В пределе тесты и требования равнозначны”. Тесты должны быть настолько чёткими, чтобы их можно было автоматизировать. A-TDD использует это утверждение и формулирует требования путём написания автоматизируемых тестов.

**Совместные сессии по прояснению требований** — Шестой принцип гибкой Разработки ПО напоминает нам: “Непосредственное общение является наиболее практичным и эффективным способом обмена информацией как с самой командой, так и внутри команды.” Непосредственное прояснение требований в рамках совместных сессий использовалось с момента изобретения [Joint Application Design (JAD)](http://www.amazon.com/Joint-Application-Development-Jane-Wood/dp/0471042994). И также используется в  [Rapid Application Development (RAD)](http://www.amazon.com/Rapid-Application-Development-James-Martin/dp/0023767758) и методе гибкой разработке - [DSDM](http://www.amazon.com/DSDM-Dynamic-Systems-Development-Practice/dp/0201178893). A-TDD так же использует непосредственное общение на совместных сессиях по формулированию требований-в-виде-тестов.

**Параллельная разработка** — Авторы книги [Concurrent Engineering Effectiveness](http://www.amazon.com/Concurrent-Engineering-Effectiveness-Integrating-Organizations/dp/1569902313) определяют параллельную разработку так: “Существует настолько тесная связь между участниками в процессе разработки ПО, что они могут осуществлять большую часть их работы примерно в одно и то же время”. Сокращение временных циклов разработки - основной драйвер параллельной разработки. Двухнедельные итерации слишком малы, поэтому командам нужно освоить путь одновременной работы — последовательная разработка не работает в коротких циклах. Мы видели, как команды изобретают Требования на Примерах снова и снова, просто потому что они хотели ответить на вопрос: “Как мы могли бы выполнять нашу работу одновременно.”

**Предотвращение вместо обнаружения** — В одном из первых исследований в книге [A Study of the Toyota Production System](http://www.amazon.com/Study-Toyota-Production-System-Engineering/dp/0915299178) Сигэо Синго пишет: “Предназначение инспекции должно быть в предотвращении; однако, мы должны изменить наш образ мышления, чтобы инспекция выполняла эту функцию.” Так же, в статье [“The Growth of Software Testing”](https://www.researchgate.net/profile/David_Gelperin/publication/234808293_The_growth_of_software_testing/links/5743149208ae9f741b37d89a/The-growth-of-software-testing.pdf) авторы идентифицируют пять периодов эволюции тестирования ПО. Они называют последний период “Период направленный на предотвращение” и стадию “Задавать вопросы, связанные с тестированием… как можно раньше часто важнее для обеспечения качества ПО и экономической эффективности разработки, чем собственно выполнение тестов”. Это в точности то, что стремятся сделать Требования на Примерах. Когда специалисты по тестированию принимают участие в совместной сессии по уточнению требований, они могут задавать вопросы о тестировании, и таким способом улучшать требования и препятствовать появлению дефектов. Всеобщее Управление Качеством (англ. Total Quality Management, TQM) - повлиявшее на Тойоту и бережливую разработку — также продвигает предотвращение вместо обнаружения.

Как работает A-TDD? Иллюстрация ниже даёт общее представление.

<figure>
  <img src="/img/test_automation/atdd.png" alt="atdd.png">
  <figcaption>Обзор A-TDD</figcaption>
</figure>

## Обзор A-TDD

A-TDD состоит из трёх шагов:

1. Обсудите требования на воркшопе.
2. Реализуйте требования одновременно в итерации.
3. Доставьте результат заинтересованным лицам для приёмки.

**Обсудите** — Требования выявляются путём обсуждения на воркшопе. Его участниками являются кросс-функциональные команды, Владелец Продукта или его представитель и любые заинтересованные лица, кто потенциально может обладать информацией о данных требованиях. Обычный вопрос, который задаётся на таких воркшопах: “Представьте, что система закончена. Как вы бы использовали её и что ожидали бы от неё?”. Ответом на такой вопрос будут примеры использования,  и такие примеры могут быть записаны как тесты, являющиеся требованиями. Фокус воркшопа должен быть больше на обсуждении и выявлении требований, чем на самих тестах.

**Реализуйте** — В конце воркшопа, примеры "дистиллированы" в тесты и другие активности, которые нужны, чтобы реализовать требования одновременно. Они включают:

* создание связующего слоя между тестами и продуктивным кодом (“тестовые библиотеки” и “низкоуровневые таблицы” в Robot Framework или ‘фикстуры’ в Fit)
* реализация требований, позволяющая тестам проходить
* обновление архитектурной и другой внутренней документации согласно рабочему соглашению команды
* актуализация пользовательской документации
* проведение дополнительного исследовательского тестирования

Точный список зависит от конкретного продукта, контекста, рабочих соглашений и [Критериев Готовности](../framework/definition-of-done.html).

**Доставьте** — Когда тесты проходят, требования проверяются Владельцем Продукта и другими заинтересованными лицами. Это может привести к появлению новых требований или изменению существующих тестов.

Более подробное описание A-TDD показано ниже

<figure>
  <img src="/img/test_automation/atdd_clarified.png" alt="atdd_clarified.png">
  <figcaption>A-TDD в деталях</figcaption>
</figure>

A-TDD шаги хорошо отражаются в LeSS цикле

<figure>
  <img src="/img/test_automation/atdd_in_iteration.png" alt="atdd_in_iteration.png">
  <figcaption>Отражения A-TDD шагов в Скраме</figcaption>
</figure>

*Обсудите на воркшопе* — Перед детализацией требований на Планированием Спринта, они совместно проясняются командой, Владельцем Продукта, и другими заинтересованными лицами на воркшопе.

*Реализуйте одновременно* — Задачи для реализации тестов/требований созданы во время Планирования Спринта и реализованы в течение итерации. Все активности происходят “примерно в одно и то же время”.

*Доставьте для приёмки* — Инкремент работающего продукта, проходящего приёмочные тесты, поставляется для приёмки заинтересованным лицам и обсуждается с ними на Обзоре Спринта.

## Обсудите на воркшопе

Эксперименты, связанные с воркшопом, тесно связаны с экспериментами в разделе "Требования". Этот раздел покрывает A-TDD темы; раздел "Требования" раскрывает тему воркшопов более детально. (раздел *7. Requirements & PBIs* из книги [Practices for Scaling Lean & Agile Development](https://www.amazon.com/Practices-Scaling-Lean-Agile-Development/dp/0321636406) [прим. переводчика])

### Обсудите на воркшопе во время Уточнения Бэклога Продукта

Команда и Владелец Продукта ‘инспектируют’ Бэклог Продукта во время [Уточнения Бэклога Продукта](../framework/product-backlog-refinement.html), чтобы удостовериться, что он находится в хорошей форме. Эта активность включает следующее:

* Оценить и прояснить недавно добавленные Элементы Бэклога Продукта.
* Разделить большие элементы на маленькие, что бы они могли быть выбраны для реализации.
* Прояснить неотложные элементы, чтобы команда хороша поняла их на уровне, достаточном для реализации.

Прояснение неотложных элементов может быть сделано через воркшоп в стиле A-TDD. Для ясности, Уточнение Бэклога Продукта состоит не только из A-TDD воркшопа, но он может быть частью активности по уточнению. Другие активности включают оценку и разбиение.

### Прояснение важнее, чем написание тестов

A-TDD для совместного прояснения требований. Акцент на общении, совместной работе и обучении через примеры и тесты. Цель состоит в улучшении понимания, а тесты являются средством её достижения. Книга на эту тему, названая подходящим образом, [Bridging the Communication Gap](http://www.amazon.com/Bridging-Communication-Gap-Specification-Acceptance/dp/0955683610) подчёркивает:

> [Разработка через приёмочное тестирование] не является техникой программирования: это техника для общения, которая сближает людей, вовлечённых в процесс разработки.

Люди часто озабочены осязаемыми выходом воркшопа - тестами - поэтому они забывают о нематериальных результатах - обучении. Понимание и ясность требований - это ключевой выход воркшопов по уточнению требований; тесты являются выражением этого.

Тут нет ложной дихотомии. Тесты тоже важны, и эта техника называется разработкой через приёмочное тестирование. Без тестов это будет только воркшоп по прояснению требований — но избегайте путаницы целей и средств.

### Используйте примеры

> “Вы можете привести пример?”

Этот вопрос может внезапно превратить смутное и абстрактное обсуждение в понятное и конкретное. Когда обсуждаются новые продукты, люди склонны заканчивать разговор на концептах и абстрактных понятиях. Они говорят друг с другом без понимания - они застряли. Приведение примеров возвращает обсуждение к реальности.

Например, мы слышим утверждение: “Система должна восстанавливаться после сбоя.” Это непонятно, поэтому мы просим привести примеры, что преображает дискуссию. Это могло бы быть: “Когда мы вытаскиваем кабель, система не должна падать”, что конкретно и понятно. Примеры также используются для дальнейшего прояснения, например, “Как система должна восстановиться, если мы удалим её блок, пока она работает?”

Примеры не так полезны для прояснения требований, как для путей работы. “Мы никогда не сможем автоматизировать все наши тесты!” - это то, что мы бы продолжили: “Вы можете привести пример теста, который нельзя автоматизировать?”, и это переносит дискуссию от теории к практике.

<figure>
  <img src="/img/test_automation/examples.png" alt="examples.png">
  <figcaption>Примеры</figcaption>
</figure>

Иллюстрация выше показывает связь между примерами, требованиями и тестами. Во время воркшопов по уточнению требований, используйте примеры для выработки требований и преобразования их в тесты.

### Не ‘оптимизируйте’ воркшоп по уточнению требований

Когда мы обсуждаем A-TDD в больших продуктовых группах, они отмечают: “Мы улучшили A-TDD воркшоп. В нём участвуют только трое: Владелец Продукта, Скрам-мастер, и специалист из команды.“ Мы спрашивали их, как другие члены команды могли бы понять требования и реализовать их, и ответ был “Специалист им расскажет“. Они ‘оптимизировали‘ воркшоп, назвав им традиционную передача требований от аналитика команде.

### Избегайте компьютеров и проекторов на воркшопе

Компьютеры высасывают жизнь из воркшопов. Они становятся центром обсуждения. Помимо проверки ссылок с материалами, избегайте необходимости ’оптимизировать’ воркшоп, вводя его непосредственно в компьютер. Вместо этого…

### Выражайте рабочий процесс в бизнес-правилах

Прояснения требований на воркшопе часто начинается с абстрактных концептов, и когда приведены примеры, обсуждение рабочего процесса переходит к: ”Пользуясь системой, я выполняю шаг 1, замет шаг 2, и ожидаю Х”.

Эти примеры рабочего процесса могут заканчиваться похоже, с небольшими различиями в один или два шага. Тесты рабочего процесса содержать скрытые бизнес-правила, которые могут быть извлечены и положены в основу тестов на основе данных. Это фокусирует дискуссию на прояснении области требований и снижает сложность, убирая неуместные детали.

### Используйте стены для тестов

Правильным домом для тестов должны быть стены - конечно, с ”белыми досками” между ними. Большие пространства ”белых досок” продвигают совместную работу — предназначение воркшопов. Зарисовки на них фотографируется. После воркшопа, тесты могут быть ”дистиллированы” и зафиксированы в A-TDD инструменте.

<figure>
  <img src="/img/test_automation/atdd_wall1.jpg" alt="atdd_wall1.jpg">
</figure>

<figure>
  <img src="/img/test_automation/atdd_wall2.jpg" alt="atdd_wall2.jpg">
</figure>

### Используйте табличный формат

Выражение бизнес-правила в таблицах делает их более понятными и помогает найти пропущенные сценарии. Таблицы вдохновляют ясное мышление. Влиятельный учёный в области информатики [Дэвид Парнас продвигает на протяжении долгого времени](http://link.springer.com/chapter/10.1007/978-3-7091-6510-2_12#page-1) таблицы для документации требований.

> [Когда документирование требований,] написание, понимание, и раскрытие их происходят одновременно… Табличная нотация является лучшей помощью в ситуациях, подобных данной. Сначала определяют структуры таблицы, убеждаясь, что заголовки покрывают все возможные сценарии, а затем обращают внимание на заполнение отдельных записей в таблице.

### Используйте тесты рабочего процесса

Извлечение бизнес-правил и использование тестов на основе данных не всегда возможно или необходимо. Некоторые требования лучше выражать в виде примера рабочего процесса (многошагового сценария). Также, тесты бизнес-правил на основе данных могут быть часто дополнены примерами рабочего процесса, таким образом, связывая их.

Предупреждение: Когда большая часть ваших тестов это тесты рабочего процесса, то вы, возможно, упустили некоторые бизнес-правила.

### Типичный план воркшопа

Из чего состоит A-TDD воркшоп? Мы часто используем следующий план: 

1. *Вступление* — Владелец Продукта приветствует всех на воркшопе и объясняет его цель.
2. *Отбор* — команда и Владелец Продукта выбирают элементы из Бэклога продукта, над которыми будут работать.
3. *Обзор* — Владелец Продукта или его представитель дают короткий обзор выбранных требований.
4. *Расхождение* — команда делится на две или три подгруппы, каждая из которых берёт один элемент и начинает набрасывать примеры на досках. Владелец Продукта и его представители перемещаются между подгруппами.
5. *Схождение* — подгруппы сходятся на время, чтобы поделиться результатами с остальными.
6. *Повторение* — цикл расхождения-схождения обычно занимает 30-45 минут. Один воркшоп содержит несколько циклов.
7. *Итоги* — Владелец Продукта подводит итоги работы. Далее следует краткое обсуждение воркшопа.
8. *Фиксация результатов* — участники делают фотографии всех записей и размещают их в вики. Они уже могут сделать выжимку в виде нескольких тестов и оформить их в A-TDD инструменте.

## Реализуйте одновременно

После того, как требования поняты, они должны быть реализованы. Разные активности, необходимые для реализации, выполняются одновременно. Команда расширяет тесты одновременно с реализацией в коде, написанием документации, обновлением архитектурного описания и так далее.

### “Дистиллируйте“ тесты

Много примеров создаётся во время воркшопа. Не все из них становятся тестами - только значимая часть требований “перегоняется“. Неважные и дублирующие части отбрасываются — они отслужили свой цели обучения на воркшопе.

Как “дистиллировать“ тесты из примеров? Вот несколько техник:

* **Дублирование** — Удалите дубликаты среди примеров, переписав тесты в другой форме. Например, набор тестов рабочего процесса может быть объединён в тест бизнес-правил. В основном это должно происходить на воркшопе.
* **Класс эквивалентности** — Некоторые примеры являются частями таких же классов эквивалентности, и поэтому одного теста будет достаточно. Люди со специализацией в тестировании особенно ценны здесь, так как разделение на классы эквивалентности является классической техникой тестирования.
* **Приёмка** — Так как не все примеры обладают одинаковым уровнем важности, спросите Владельца Продукта: “Какой набор примеров вы хотели бы видеть работающими в конце итерации?”

### Используйте фасилитаторов и тренеров по A-TDD

A-TDD легко понять, но трудно следовать. Он требует бросить вызов глубоким укоренившимся предположениям и изменить привычки. Часто для этого необходим тренер (внешний) с опытом в A-TDD и организационных изменениях. Найдите такого тренера.

Важно понимать, что навыки хорошего A-TDD тренера отличаются от таковых у тренера по TDD. Обучение TDD более техническое и сфокусировано на индивидуальных навыках разработчиков, тогда как A-TDD вовлекает команду целиком. В дополнении к техническим, хороший A-TDD тренер имеет хорошие отличные навыки фасилитации.

### Используйте A-TDD инструмент

* Fit (акроним от Framework for Integrated Test [прим. переводчика]), возможно, первый инструмент для A-TDD. Он был разработан Уордом Каннингемом в 2002 году. Fit-тесты состоят из HTML-таблиц, которые выполняются с помощью фрагмента кода, называемого фикстурой. Мика (англ. Micah) and Боб Мартины создали расширение FitNesse, в котором таблицы размещаются в вики. FitNesse также включает Slim (Simple List Invocation Method [прим. переводчика]) — более тонкая модель исполнения, обеспечивающая лучшую переносимость и гибкость для изучения новых синтаксисов тестирования. Больше информации вы можете найти в разделе “Рекомендуем к прочтению“ в конце этого раздела.
* Robot Framework берёт своё начало в компании Nokia Siemens Networks и был разработан Пеккой Кларком. Он был выпущен в 2008 году. Robot имеет некоторые сходства с Fit такие, как таблично структурированные тесты и связующий код между таблицами и системой. Однако он имеет уникальные пользовательские свойства такие, как многослойные таблицы (ключевые слова пользователей).
* Cucumber был разработан Аслаком Хэллисейем и вдохновлён Дэном Нортом. Он следует формату дано/когда/тогда (англ. given/when/then) для описания примеров. Cucumber тесты читаются, как предложения в простом тексте.

### Не используйте традиционные тестовые инструменты для A-TDD

Некоторые продуктовые группы, с которыми мы работали, пытаются использовать свои традиционные инструменты для тестирования такие, как Lisp скрипты или TTCN для A-TDD. Они постоянно терпят неудачу. Почему? Тесты в стиле A-TDD создаются так, чтобы Владелец Продукта или пользователь могли их прочитать и понять. А тесты в виде скриптов в традиционных инструментах создаются для инженеров по тестированию и поэтому не подходят для документирования требований. Почти невозможно вовлечь Владельца Продукта в написание примеров в таком инструменте.

### Обращайтесь к традиционным инструментам в A-TDD инструментах

Должны ли вы выкинуть все традиционные тестовые инструменты после перехода на A-TDD? Скорее всего нет.

Продуктовая группа, с которой мы работали, потратила годы на создание скриптового языка для автоматизации тестов. Разработка связующего слоя (тестовых библиотек или фикстур) между A-TDD фреймворком и их системой могла бы занять ещё несколько лет  - большинство из этого они могли сделать на их скриптовом языке.

Альтернативой было бы позволить связующему коду обернуть их тестовый скриптовый язык и использовать его намного раньше. Традиционные инструменты не всегда плохи, но они обеспечивают неверный формат - неверный язык - для исполняемых спецификаций.

## Доставьте для приёмки

Исходный код написан и все тесты пройдены. Что дальше? A-TDD, как и Скрам, содержит цикл инспекции-адаптации, когда результаты доставляются заинтересованным лицам, которые инспектируют итоги, используя тесты, и принимают решения, как действовать дальше - какие требования реализовать следующими.

## Показывайте тесты на Обзоре Спринта

На [Обзоре Спринта](../framework/sprint-review.html) команды демонстрируют видимый прогресс Владельцу Продукта, показывая результаты итерации.

Мы работали с некоторыми продуктовыми группами, которые определяли, как они будут показывать инкремент, ещё на Планировании Спринта. Команда тратила чрезмерное количество времени на подготовку к демонстрации. Это чистые потери.

Во время [Планирования Спринта](../framework/sprint-planning-one.html) более подходящей альтернативой будет определение примеров сценариев, которые должны успешно выполняться, и демонстрация прогресса с использованием этих примеров на Обзоре Спринта.

## Рекомендуем к прочтению

* [*Specification by Example*](http://www.amazon.com/Specification-Example-Successful-Deliver-Software/dp/1617290084) Гойко Аджича. Эта книга покрывает несколько примеров из практики "Specification by Example". Гойко придумал сам термин, чтобы заменить все предыдущие, такие как A-TDD.
* [*Bridging the Communication Gap*](http://www.amazon.com/Bridging-Communication-Gap-Specification-Acceptance/dp/0955683610/ref=sr_1_1?ie=UTF8&qid=1415541943&sr=8-1&keywords=bridging+communication+gap) Гойко Аджича. Вышла до "Specification by Example",  фокусируется на прояснении требований и воркшопах.
* [*Acceptance Test Driven Development: An Overview*](http://testobsessed.com/2008/12/acceptance-test-driven-development-atdd-an-overview/) Элизабет Хендриксон. Заметка в блоге и соответствующая статья предлагают обзор A-TDD на подробных примерах использования Robot Framework.
* [*Fit for Developing Software*](http://www.amazon.com/Fit-Developing-Software-Framework-Integrated/dp/0321269349) Рика Магриджа и Уорда Каннингема. Книга фокусируется на улучшении общения при передаче требований на основе Fit таблиц.
* [*Robot Framework User Guide*](https://code.google.com/p/robotframework/wiki/UserGuide). Не покрывает тему A-TDD, но позволяет отлично познакомиться с инструментом Robot Framework.
* [*Test-Driven .NET Development with FitNesse*](http://www.amazon.com/Test-Driven-NET-Development-FitNesse/dp/0955683602) Гойко Аджича. В этой книге меньше внимания уделяется A-TDD, а больше - FitNesse. Но это хорошо работает для описания данного инструмента.

Перевод статьи осуществлён [Кротовым Артёмом](https://www.facebook.com/artem.v.krotov).